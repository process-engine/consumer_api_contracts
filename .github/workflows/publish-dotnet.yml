name: Dotnet CI

on:
  push:
    branches:
      - "*"
      - "*/*"

jobs:
  build:

    runs-on: ubuntu-latest
    if: "!(contains(github.actor, 'process-engine-ci') || contains(github.actor, 'admin'))"

    steps:
    - uses: actions/checkout@v1

    - name: 'Install Dependencies'
      working-directory: ./dotnet
      run: npm i

    - name: 'Prepare Version'
      working-directory: ./dotnet
      id: prepare_version
      run: |
        dotnet --version
        dotnet restore src
        echo "##[set-output name=version;]$(node --eval "dotnet-version.js get-package-version")"

    - name: 'Show Version'
      run: echo $VERSION
      env:
        VERSION: ${{ steps.prepare_version.outputs.version }}
